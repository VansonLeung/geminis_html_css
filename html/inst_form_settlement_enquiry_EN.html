<style type="text/css">
.redbartop{
        width: 100%; height: 10px;  background-color: #bc0000;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }
    .subsubmenuBar{
     background-color: #dddddd;
            height: calc(100% - 20px);
    }



    @media only screen and (max-width: 992px) {
    #subsubMenu{
          height: 70px;
        background-color: white;
        margin-top: 40px;
        margin-bottom: 20px;
        border-radius: 8px;  
    }

    .subsubmenuBox{
     background-color: rgba(0,0,0,0);
     height: 100%;
     padding: 10px 20px 0px 20px;
     font-size:18px;
     text-align:center;
     color:#6c6c6c;
     float: left;
         cursor: pointer;
    }
    }
    @media only screen and (min-width: 992px) {
    #subsubMenu{
          height: 90px;
        background-color: white;
        margin-top: 40px;
        margin-bottom: 20px;
        border-radius: 8px;  
    }

    .subsubmenuBox{
     background-color: rgba(0,0,0,0);
     height: 100%;
     padding: 20px 30px 0px 30px;
     font-size:24px;
     text-align:center;
     color:#6c6c6c;
     float: left;
         cursor: pointer;
    }
    }


    .subsubmenuBox-Active{
     color:#bc0000;
     background-color: #ffffff;
    }
    .subsubmenuBox-Active p{
     color:#bc0000;
        border-bottom: 4px solid #bc0000 !important;
    }
    .subsubmenuBox p{
     color:#6c6c6c;
        margin: 0px;
        border-bottom: 0px solid #bc0000;
    }
    .subsubmenuBox-Active a{
     color:#bc0000;
        
    }
    .subsubmenuBox a{
     color:#6c6c6c;

    }
    .stepbar{
        height:377px;border-radius: 8px;background-color: #fff;max-width: 284px;padding-top: 55px;padding-left:72px;
    }
    .enqu{
    display: block;
        padding: 0px !important;
    }
    .inst{
    display: none;

    }

    .stepBottomBar{
        width:100%; 
    }
    #stepback{
      height:87px; background-color: #9b9b9b;text-align: center;font-size: 20px;vertical-align: middle;line-height: 87px;color:#fff;  
    }
    #stepgo{
        height:87px; background-color: #4a4a4a;text-align: center;font-size: 20px;vertical-align: middle;line-height: 87px;color:#fff;
    }

    .menustepArea{
        padding:0;margin:0;
    }
    .menustepIcon{
    display:none;width:16px;height:16px;
    }
    .menustepText{
    text-align:left;color:#666;font-size: 16px;line-height: 24px;
    }
    .menustepText-Active{
    text-align:left;color:#d94634;font-size: 16px;line-height: 24px;
    }


</style>


<style>
.clickable{
  cursor: pointer;
}
.dataTables_paginate{
  width: 100%;
  text-align: center !important;
  padding-top: 0px !important;
  margin-top: 15px;
  border-top: 1px gray solid;
}
.paginate_button,
.searchpage_button{
  margin:-2px;
}
.dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover,
.searchpage_button:hover,
.dataTables_wrapper .dataTables_paginate .paginate_button.current{
  border-top: 3px red solid;
}
.select-style select{
   -webkit-appearance: menulist-button;
  width: 100%;
  border: 1px
  solid rgb(148,148,148);
  border-radius: 5px;
}
.nowrap{
  white-space: nowrap;
}
</style>


<style>
table.dataTable thead .sorting,
table.dataTable thead .sorting_asc,
table.dataTable thead .sorting_desc{background: #656667;}
table.dataTable thead .sorting:after,
table.dataTable thead .sorting_asc:after,
table.dataTable thead .sorting_desc:after{ font-family: FontAwesome;padding-left:.4em;color:gray;}
table.dataTable thead .sorting:after{content: '\f0dc';}
table.dataTable thead .sorting_desc:after{content: '\f0dd';color: white;}
table.dataTable thead .sorting_asc:after{content: '\f0de';color: white;}
.dataTables_paginate{
  margin-top: 0px;
  border-top: 1px gray solid;}
.paginate_button{margin:-2px;}
.dataTables_wrapper .dataTables_paginate .paginate_button.current{border-top: 3px red solid !important;}


table.dataTable thead th{
  font-size: 14px;
}
table.dataTable.no-footer {
     border-bottom: 0px solid #111; 
}

table.dataTable tbody th, table.dataTable tbody td {
    padding: 8px 18px;
}
.generic-table-content tr td:last-child {
    padding-right: 35px;
}
.nowrap{
    white-space: nowrap;
}
</style>
<section>
<div class="row" style="max-width: 1300px;">
<div class="col s12 m12 l12" style="padding:0 !important;">
<div id="subsubMenu">
<div class="redbartop">&nbsp;</div>

<div class="subsubmenuBar">
<div class="subsubmenuBox" data-gmnsubsubmenu="inst">
<p><a href="../stock-instruction/">Settlement Instruction</a></p>
</div>

<div class="subsubmenuBox subsubmenuBox-Active" data-gmnsubsubmenu="enqu">
<p>Settlement Instruction Enquiry</p>
</div>
</div>
</div>
</div>

<div class="enqu" id="enquArea">&nbsp; <!-- enqu -->
<div class="gem_form notopstripe">
<div>
<table class="generic-table-header smallmedpadding">
  <tbody>
    <tr>
      <td class="font_lg">Settlement Instruction Enquiry</td>
    </tr>
  </tbody>
</table>
<table style="background-color: white;    border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; width:100%;" class="responsive generic-table-content font_smedmed tblIPOCalendar" cellspacing="0" width="100%">
    </table>
</div>
</div>
<!-- enqu --></div>
</div>
</section>
<script>
$(function(e){

    $('.subsubmenuBox').on('click',function(e){
        var subsubItem = $(this).data().gmnsubsubmenu;
        if(subsubItem == 'inst'){
        turnLoader('c');
            window.location.href="../stock-instruction/";
        }
        if(subsubItem == 'enqu'){
            // window.location.href="../stock-instruction-enquiry/";
        }
    });
 
    window.loadUIDataSet = function loadUIDataSet() {
        var dataSet = {}
        dataSet.acct = "9910-268";
        dataSet.pwd = "12345678";
        return dataSet;
    }
    window.gen_table_ui = function gen_table_ui(){
        var str ='';
        str += '<thead>';
        str += '    <tr>';
        str += '        <th class="nowrap">'+nls.refno+'</th>';
        str += '        <th class="nowrap">'+nls.createtime+'</th>';
        str += '        <th class="nowrap">'+nls.transtype+'</th>';
        str += '        <th class="nowrap">'+nls.market+'</th>';
        str += '        <th class="nowrap">'+nls.labelno+'</th>';
        str += '        <th class="nowrap">'+nls.inst+'</th>';
        str += '        <th class="nowrap">'+nls.qty+'</th>';
        str += '        <th class="nowrap">'+nls.methods+'</th>';
        str += '        <th class="nowrap">'+nls.remark+'</th>';
        str += '        <th class="nowrap">'+nls.status+'</th>';
        str += '    </tr>';
        str += '</thead>';              
        return str;
    }
    window.initJS = function initJS(){

        window.nls = {
            deposit: 'Deposit',
            withdraw: 'Withdrawal',
            fop: 'Free of Payment',
            dvp : 'Delivery Against Payment',
            refno:'Ref&nbsp;No',
            createtime:'Instructiom&nbsp;Time',
            market:'Market',
            labelno:'Stock&nbsp;Code',
            inst:'Stock&nbsp;Name',
            qty:'Quantity',
            methods:'Settle&nbsp;Method',
            createdate:'Create Date',
            transtype:'Settle&nbsp;Type',
            status:'Status',
            statusR:'Received',
            statusP:'Pending for Approval',
            statusC:'Cancelled',
            statusA:'Approved',
            statusX:'Rejected',
            remark:'Remark',
            nodata:'No Record'
        };

        window.glostepback = 1;
        window.glostepgo = 2;

        window.glo = {}
        glo.isloginflag = false;
        glo.sessionid = "@{S:SESSIONID}";
        glo.clientid = "@{S:CLIENTID}";
        var transacctlst = '@{S:TRADINGACCLIST}';
        // glo.sessionid = "";
        // glo.clientid = "";
        // transacctlst = "";
        transacctlst != "" && (glo.tranaccseq = JSON.parse(transacctlst));

        glo.locallang =convtoi18n("@{S:LANG}","@{S:CULTURE}");

        loadEnquiryData();

    }
    window.numberWithCommas = function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    window.convtoi18n = function convtoi18n(lang,culture){
        var langculture = [];
        var sellang = lang+'_'+culture;
        langculture['zh_HK'] = "zh_TW";
        langculture['zh_TW'] = "zh_TW";
        langculture['cn_CN'] = "zh_CN";
        langculture['zh_CN'] = "zh_CN";
        langculture['en_US'] = "en_US";
        if(langculture[sellang] == undefined){
            return 'en_US';
        }else{
            return langculture[sellang];
        }
    }
    window.convstatus = function convstatus(type){
        var convt = '';
        switch(type){
            case 'R': convt = '<b style="color:black">'+nls.statusR+'</b>';break;
            case 'P': convt = '<b style="color:black">'+nls.statusP+'</b>';break;
            case 'A': convt = '<b style="color:#4caf50">'+nls.statusA+'</b>';break;
            case 'X': convt = '<b style="color:#d43b30">'+nls.statusX+'</b>';break;
            case 'C': convt = '<b style="color:#6c6c6c">'+nls.statusC+'</b>';break;
            default:;
        }
        return convt;
    } 
    window.loadMarketList = function loadMarketList(){
      var data = [
        {name:'HKEX',label:'Hong Kong'},
        {name:'MAMK',label:'Mainland A-Share'},
        {name:'SZMK',label:'Shenzhen A-Share'},
        {name:'USEX',label:'United States'},
        {name:'TWEX',label:'Taiwan'},
        {name:'AUEX',label:'Australia'},
        {name:'CAEX',label:'Canada'},
        {name:'CHEX',label:'Switzerland'},
        {name:'EUEX',label:'Europe'},
        {name:'GREX',label:'Germany'},
        {name:'IDEX',label:'Indonesia'},
        {name:'JPEX',label:'Japan'},
        {name:'KREX',label:'South Korea'},
        {name:'MYEX',label:'Malaysia'},
        {name:'PHEX',label:'Philippines'},
        {name:'SGEX',label:'Singapore'},
        {name:'SHEB',label:'Shanghai B-Share'},
        {name:'THEX',label:'Thailand'}
        ];
      return data;
    } 
    window.getMarketLabel = function getMarketLabel(name,list){
      var label = '';
      for (var i = 0; i < list.length; i++) {
        if(list[i].name == name){
          label = list[i].label;
        }
      }
      return label;
    }
    window.renderDatatable = function renderDatatable(langtxt){
        $('.tblIPOCalendar').DataTable({
          "language": langtxt,
          "columnDefs":[{className:"dt-right", "targets": [ 6 ]}],
          "iDisplayLength": 10,
          "responsive": true,
          "info": false,
          "ordering": true,
          "paging": true,
          "searching": false,     
          "bLengthChange": false,
          "order" : [[ 0, "desc" ]]
        });
        $('.dataTables_paginate').css("width","100%");
        $('.dataTables_paginate').css("text-align","center");
        $('.dataTables_paginate').css("padding-top","0px");        
    }
    window.loadEnquiryData = function loadEnquiryData() {

        var dtlang_en = {
            "processing"  :"Processing...",
            "sProcessing" :"Processing...",
            "sLengthMenu" :"Show _MENU_ Items",
            "sZeroRecords"  :"No Data Available",
            "sInfo"     :"From _START_ To _END_ Items, Total _TOTAL_ Items",
            "sInfoEmpty"  :"From 0 To 0 Item, Total 0 Item",
            "sInfoFiltered" :"(From _MAX_ items searching result)",
            "sInfoPostFix"  :"",
            "sSearch"   :"Search:",
            "sUrl"      :"",
            "oPaginate"   :{"sFirst":"First","sPrevious":"Previous","sNext":"Next","sLast":"Last"},
            "sWeekDays"   :['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
            "sMonths"   :['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            "sToday"    :"Today"
        };
        var dtlang_zh_TW = {
            "processing"  :"處理中...",
            "sProcessing" :"處理中...",
            "sLengthMenu" :"顯示 _MENU_ 項結果",
            "sZeroRecords"  :"沒有匹配結果",
            "sInfo"     :"顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
            "sInfoEmpty"  :"顯示第 0 至 0 項結果，共 0 項",
            "sInfoFiltered" :"(從 _MAX_ 項結果過濾)",
            "sInfoPostFix"  :"",
            "sSearch"   :"搜索:",
            "sUrl"      :"",
            "oPaginate"   :{"sFirst":"首頁","sPrevious":"上頁","sNext":"下頁","sLast":"尾頁"},
            "sWeekDays"   :['日', '一', '二', '三', '四', '五', '六'],
            "sMonths"   :['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            "sToday"    :"今天"
        };
        var dtlang_zh_CN = {
            "processing"  :"处理中...",
            "sProcessing" :"处理中...",
            "sLengthMenu" :"显示 _MENU_ 项结果",
            "sZeroRecords"  :"没有匹配结果",
            "sInfo"     :"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
            "sInfoEmpty"  :"显示第 0 至 0 项结果，共 0 项",
            "sInfoFiltered" :"(从 _MAX_ 项结果过滤)",
            "sInfoPostFix"  :"",
            "sSearch"   :"搜索:",
            "sUrl"      :"",
            "oPaginate"   :{"sFirst":"首页","sPrevious":"上页","sNext":"下页","sLast":"尾页"},
            "sWeekDays"   :['日', '一', '二', '三', '四', '五', '六'],
            "sMonths"   :['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            "sToday"    :"今天"
        };
      var lang = 'en';
      var langtxt=("en"==lang)?dtlang_en:"zh_TW"==lang?dtlang_zh_TW:dtlang_zh_CN;

        var enquiryForm = {
            clientID: glo.clientid,
            sessionID: glo.sessionid,
            language: glo.locallang,
            tradingAccSeq: 1
        }
        var loadDS = loadUIDataSet();
        var enloaddata = {
            "form": {
                "name": "settlementInstructionEnquiry",
                "credentials": {
                    "username": loadDS.acct,
                    "password": loadDS.pwd
                },
                "header": {
                    "version": "1",
                    "traceNo": "1"
                },
                "body": enquiryForm
            }
        }
        turnLoader('c');
        $.ajax({
            type: 'POST',
            // url: 'test.json',
            url: '/api/session/submitSoapQuery',
            data: JSON.stringify(enloaddata),
            contentType: 'application/json',
            dataType: 'json',
            success: function(responseData, textStatus, jqXHR) {
                var resuData = responseData.data;
                if (resuData.settlementInstructionList && resuData.settlementInstructionList.length > 0) {
                    var convData = resuData.settlementInstructionList;
                    var loadthUI = '';
                    loadthUI += gen_table_ui();                  
                    loadthUI += '<tbody>';    
                    for (var i = 0; i < convData.length; i++) {
                        if(convData[i].stockInformationList && convData[i].stockInformationList.length > 0){
                            for(var j =0;j< convData[i].stockInformationList.length;j++){
                                var cursubsettItem = convData[i].stockInformationList[j];
                                var convtime = '/ /';
                                 convtime = convData[i].creationTime.split(' ');
                                 var instLabel = '';
                                 var settlLabel = '';
                                 if(convData[i].instruction == 'D'){
                                    instLabel = nls.deposit;
                                 }
                                 if(convData[i].instruction == 'W'){
                                    instLabel = nls.withdraw;
                                 }
                                 if(convData[i].settlementMethod == 'FOP'){
                                    settlLabel = nls.fop;
                                 }
                                 if(convData[i].settlementMethod == 'DVP'){
                                    settlLabel = nls.dvp;
                                 }
                                loadthUI += '<tr> \
                                <td class="nowrap">' + convData[i].transactionID + '</td> \
                                <td class="nowrap">' + convData[i].creationTime + '</td> \
                                <td class="nowrap">' + instLabel + '</td> \
                                <td class="nowrap">' + getMarketLabel(cursubsettItem.marketID,loadMarketList()) + '</td> \
                                <td class="nowrap">' + cursubsettItem.instrumentID + '</td> \
                                <td class="nowrap">' + cursubsettItem.instrumentName + '</td> \
                                <td class="nowrap">' + numberWithCommas(cursubsettItem.qty) + '</td> \
                                <td class="nowrap">' + settlLabel + '</td>  \
                                <td class="nowrap">'+cursubsettItem.remarks+'</td> \
                                <td class="nowrap">' + convstatus(convData[i].status) + '</td> \
                                </tr>';
                            }
                        }
                    }                                  
                    loadthUI += '</tbody>';                  
                    $('.tblIPOCalendar').empty().append(loadthUI);
                    renderDatatable(langtxt);
                turnLoader();
                }else{
                    var loadthUI = '';
                    loadthUI += gen_table_ui();
                    loadthUI +='<tbody>';
                    loadthUI +='</tbody>';
                    $('.tblIPOCalendar').empty().append(loadthUI);
                    renderDatatable(langtxt);
                turnLoader();
              }
            },
            error: function(responseData, textStatus, errorThrown) {
                    var loadthUI = '';
                    loadthUI += gen_table_ui();
                    loadthUI +='<tbody>';
                    loadthUI +='</tbody>';
                    $('.tblIPOCalendar').empty().append(loadthUI);
                    renderDatatable(langtxt);
                turnLoader();
            }
        });
    }
    initJS();
});
</script>